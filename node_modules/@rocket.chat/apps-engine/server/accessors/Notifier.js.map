{"version":3,"sources":["src/server/accessors/Notifier.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,oEAAmF;AAKnF,qDAAkD;AAElD,MAAa,QAAQ;IACjB,YACqB,UAAuB,EACvB,SAAyB,EACzB,KAAa;QAFb,eAAU,GAAV,UAAU,CAAa;QACvB,cAAS,GAAT,SAAS,CAAgB;QACzB,UAAK,GAAL,KAAK,CAAQ;IAC9B,CAAC;IAEQ,UAAU,CAAC,IAAW,EAAE,OAAiB;;YAClD,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE;gBACvC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAE7D,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;aAC5B;YAED,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/D,CAAC;KAAA;IAEY,UAAU,CAAC,IAAW,EAAE,OAAiB;;YAClD,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE;gBACvC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAE7D,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;aAC5B;YAED,MAAM,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/D,CAAC;KAAA;IAEY,MAAM,CAAC,OAAuB;;YACvC,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,IAAI,uBAAW,CAAC,IAAI,CAAC;YAElD,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE;gBACnB,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC7D,OAAO,CAAC,QAAQ,GAAG,OAAO,IAAI,OAAO,CAAC,IAAI,IAAI,EAAE,CAAC;aACpD;YAED,IAAI,CAAC,SAAS,CAAC,MAAM,iCAAM,OAAO,KAAE,QAAQ,EAAE,IAAI,KAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YAElE,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,iCAAM,OAAO,KAAE,QAAQ,EAAE,KAAK,KAAI,IAAI,CAAC,KAAK,CAAC,CAAC;QACpF,CAAC;KAAA;IAEM,iBAAiB;QACpB,OAAO,IAAI,+BAAc,EAAE,CAAC;IAChC,CAAC;CACJ;AA3CD,4BA2CC","file":"Notifier.js","sourcesContent":["import { IMessageBuilder, INotifier } from '../../definition/accessors';\nimport { ITypingOptions, TypingScope } from '../../definition/accessors/INotifier';\nimport { IMessage } from '../../definition/messages';\nimport { IRoom } from '../../definition/rooms';\nimport { IUser } from '../../definition/users';\nimport { IMessageBridge, IUserBridge } from '../bridges';\nimport { MessageBuilder } from './MessageBuilder';\n\nexport class Notifier implements INotifier {\n    constructor(\n        private readonly userBridge: IUserBridge,\n        private readonly msgBridge: IMessageBridge,\n        private readonly appId: string,\n    ) { }\n\n    public async notifyUser(user: IUser, message: IMessage): Promise<void> {\n        if (!message.sender || !message.sender.id) {\n            const appUser = await this.userBridge.getAppUser(this.appId);\n\n            message.sender = appUser;\n        }\n\n        await this.msgBridge.notifyUser(user, message, this.appId);\n    }\n\n    public async notifyRoom(room: IRoom, message: IMessage): Promise<void> {\n        if (!message.sender || !message.sender.id) {\n            const appUser = await this.userBridge.getAppUser(this.appId);\n\n            message.sender = appUser;\n        }\n\n        await this.msgBridge.notifyRoom(room, message, this.appId);\n    }\n\n    public async typing(options: ITypingOptions): Promise<() => Promise<void>> {\n        options.scope = options.scope || TypingScope.Room;\n\n        if (!options.username) {\n            const appUser = await this.userBridge.getAppUser(this.appId);\n            options.username = appUser && appUser.name || '';\n        }\n\n        this.msgBridge.typing({ ...options, isTyping: true }, this.appId);\n\n        return () => this.msgBridge.typing({ ...options, isTyping: false }, this.appId);\n    }\n\n    public getMessageBuilder(): IMessageBuilder {\n        return new MessageBuilder();\n    }\n}\n"]}