{"version":3,"sources":["src/server/permissions/checkers/AppCloudBridge.ts"],"names":[],"mappings":";;;AAAA,8EAA2E;AAC3E,8EAA2E;AAC3E,sDAAmD;AAEtC,QAAA,cAAc,GAAG;IAC1B,iBAAiB,CAAC,KAAa,EAAE,KAAa;;QAC1C,MAAM,iBAAiB,GAAG,2CAAoB,CAAC,aAAa,CAAC,KAAK,EAAE,+BAAc,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC;QAC7G,MAAM,cAAc,GAAG,OAAA,iBAAiB,aAAjB,iBAAiB,uBAAjB,iBAAiB,CAAE,MAAM,0CAAE,QAAQ,CAAC,KAAK,OAAM,KAAK,CAAC;QAE5E,IAAI,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE;YAC/B,MAAM,IAAI,6CAAqB,CAAC;gBAC5B,KAAK;gBACL,kBAAkB,EAAE,CAAC,+BAAc,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;gBAC7D,OAAO,EAAE,oBAAoB,KAAK,aAAa;aAClD,CAAC,CAAC;SACN;QAED,IAAI,CAAC,iBAAiB,IAAI,cAAc,EAAE;YACtC,MAAM,IAAI,6CAAqB,iBAC3B,KAAK,EACL,kBAAkB,EAAE,CAAC,+BAAc,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,IAC1D,cAAc,IAAI,EAAE,MAAM,EAAE,kBAAkB,KAAK,iBAAiB,EAAE,EAC3E,CAAC;SACN;IACL,CAAC;CACJ,CAAC","file":"AppCloudBridge.js","sourcesContent":["import { PermissionDeniedError } from '../../errors/PermissionDeniedError';\nimport { AppPermissionManager } from '../../managers/AppPermissionManager';\nimport { AppPermissions } from '../AppPermissions';\n\nexport const AppCloudBridge = {\n    getWorkspaceToken(scope: string, appId: string): void {\n        const grantedPermission = AppPermissionManager.hasPermission(appId, AppPermissions.cloud['workspace-token']);\n        const isMissingScope = grantedPermission?.scopes?.includes(scope) === false;\n\n        if (scope.startsWith('workspace')) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions.cloud['workspace-token']],\n                message: `Forbidden scope \"${scope}\" requested`,\n            });\n        }\n\n        if (!grantedPermission || isMissingScope) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions.cloud['workspace-token']],\n                ...isMissingScope && { reason: `Missing scope \"${scope}\" in permission` },\n            });\n        }\n    },\n};\n"]}