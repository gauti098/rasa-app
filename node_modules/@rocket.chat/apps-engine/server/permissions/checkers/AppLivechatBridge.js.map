{"version":3,"sources":["src/server/permissions/checkers/AppLivechatBridge.ts"],"names":[],"mappings":"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","file":"AppLivechatBridge.js","sourcesContent":["import { ILivechatMessage, ILivechatRoom, ILivechatTransferData, IVisitor } from '../../../definition/livechat';\nimport { IUser } from '../../../definition/users';\nimport { PermissionDeniedError } from '../../errors/PermissionDeniedError';\nimport { AppPermissionManager } from '../../managers/AppPermissionManager';\nimport { AppPermissions } from '../AppPermissions';\n\nexport const AppLivechatBridge = {\n    isOnline(departmentId?: string, appId?: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-status'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-status'].read],\n            });\n        }\n    },\n    isOnlineAsync(departmentId?: string, appId?: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-status'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-status'].read],\n            });\n        }\n    },\n    updateMessage(message: ILivechatMessage, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-message'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-message'].write],\n            });\n        }\n    },\n    createMessage(message: ILivechatMessage, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-message'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-message'].write],\n            });\n        }\n    },\n    createVisitor(visitor: IVisitor, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].write],\n            });\n        }\n    },\n    findVisitors(query: object, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].read],\n            });\n        }\n    },\n    findVisitorById(id: string, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].read],\n            });\n        }\n    },\n    findVisitorByEmail(email: string, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].read],\n            });\n        }\n    },\n    findVisitorByToken(token: string, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].read],\n            });\n        }\n    },\n    findVisitorByPhoneNumber(phoneNumber: string, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].read],\n            });\n        }\n    },\n    transferVisitor(visitor: IVisitor, transferData: ILivechatTransferData, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-visitor'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-visitor'].write],\n            });\n        }\n    },\n    createRoom(visitor: IVisitor, agent: IUser, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-room'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-room'].write],\n            });\n        }\n    },\n    closeRoom(room: ILivechatRoom, comment: string, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-room'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-room'].write],\n            });\n        }\n    },\n    findRooms(visitor: IVisitor, departmentId: string | null, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-room'].read)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-room'].read],\n            });\n        }\n    },\n    findDepartmentsEnabledWithAgents(appId: string) {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-department'].multiple)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-department'].multiple],\n            });\n        }\n    },\n    findDepartmentByIdOrName(value: string, appId: string): void {\n        if (\n            !AppPermissionManager.hasPermission(appId, AppPermissions['livechat-department'].read)\n         && !AppPermissionManager.hasPermission(appId, AppPermissions['livechat-department'].multiple)\n        ) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-department'].read],\n            });\n        }\n    },\n    setCustomFields(data: { token: IVisitor['token']; key: string; value: string; overwrite: boolean }, appId: string): void {\n        if (!AppPermissionManager.hasPermission(appId, AppPermissions['livechat-custom-fields'].write)) {\n            throw new PermissionDeniedError({\n                appId,\n                missingPermissions: [AppPermissions['livechat-custom-fields'].write],\n            });\n        }\n    },\n};\n"]}